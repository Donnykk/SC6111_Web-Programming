
# API 文档

## 概述

该API文档描述了一个交易系统的四个主要API端点，这些端点用于获取买单和卖单的订单信息、提交交易请求、以及获取市场交易数据。

---

## 1. 获取买单数据

### `GET /api/buy-orders`

**描述**: 从数据库中获取最近的十条买单记录，并按价格降序排列。

- **请求方法**: `GET`
- **URL**: `/api/buy-orders`
- **请求参数**: 无

**响应示例**:

```json
[
    {
        "price": 56571.73,
        "amount": 0.10606
    },
    {
        "price": 56571.70,
        "amount": 1.70842
    },
    ...
]
```

---

## 2. 获取卖单数据

### `GET /api/sell-orders`

**描述**: 从数据库中获取最近的十条卖单记录，并按价格降序排列。

- **请求方法**: `GET`
- **URL**: `/api/sell-orders`
- **请求参数**: 无

**响应示例**:

```json
[
    {
        "price": 56569.00,
        "amount": 5.60165
    },
    {
        "price": 56568.99,
        "amount": 0.08220
    },
    ...
]
```

---

## 3. 提交交易请求

### `POST /api/trade`

**描述**: 通过此API，用户可以提交买入或卖出订单。

- **请求方法**: `POST`
- **URL**: `/api/trade`
- **请求头**: `Content-Type: application/json`
- **请求参数**:

    - `price` (浮点数, 必需): 交易价格。
    - `amount` (浮点数, 必需): 交易数量。
    - `type` (字符串, 必需): 交易类型，值为 `"buy"` 或 `"sell"`。

**请求示例**:

```json
{
    "price": 56425.00,
    "amount": 0.5,
    "type": "buy"
}
```

**响应示例**:

```json
{
    "status": "success",
    "message": "Trade executed successfully"
}
```

**错误响应示例**:

```json
{
    "status": "error",
    "message": "Invalid trade parameters"
}
```

---

## 4. 获取市场交易数据

### `GET /api/trade-history`

**描述**: 从数据库中获取最近的十条市场交易记录，包括价格、数量和时间。

- **请求方法**: `GET`
- **URL**: `/api/trade-history`
- **请求参数**: 无

**响应示例**:

```json
[
    {
        "price": 56569.00,
        "amount": 0.01716,
        "time": "15:25:07"
    },
    {
        "price": 56569.00,
        "amount": 0.00200,
        "time": "15:25:07"
    },
    ...
]
```

---

## 注意事项

- **数据验证**: 所有请求数据将进行验证，确保格式正确且值在合理范围内。
- **错误处理**: 服务器将处理各种可能的错误情况并返回适当的错误响应，如请求格式不正确或服务器内部错误。
- **安全性**: 为了保护用户数据和交易的完整性，所有请求应通过HTTPS协议进行，确保数据传输的安全性。

以上API文档详细描述了交易系统所需的各个端点的功能和使用方法。根据这些API文档，可以有效地进行前端与后端的数据交互，实现预期的交易功能。

# 程序逻辑说明

货币基准以微信群图片为准，`price`和`amount`限制为2位小数。

![image](https://github.com/user-attachments/assets/0da2f7cf-cb56-4eb2-b2cd-eeed2d53c59b)

## 程序逻辑

### 买

1. **当价格低于盘点值时**:
    - 检查 `buy_order` 表中是否有对应价格表项。
    - 如果没有，则插入到 `buy_order` 表。
    - 如果有，则更新 `amount` 值。

2. **当价格等于盘点值时**:
    - 以盘点值结算到市场交易数据 `trade_history` 中。

3. **当价格高于盘点值时**:
    - 仍以盘点值结算到市场交易数据 `trade_history` 中。

### 卖

1. **当价格高于盘点值时**:
    - 检查 `sell_order` 表中是否有对应价格表项。
    - 如果没有，则插入到 `sell_order` 表。
    - 如果有，则更新 `amount` 值。

2. **当价格等于盘点值时**:
    - 以盘点值结算到市场交易数据 `trade_history` 中。

3. **当价格低于盘点值时**:
    - 仍以盘点值结算到市场交易数据 `trade_history` 中。


